<!doctype html>
<html lang="en">
<head>
  <title>Compare Players | SportSight</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body{
      margin:0;
      font-family:Arial, sans-serif;
      background: radial-gradient(circle at top, #0b1220, #050816);
      color:white;
    }

    .top{
      padding:22px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    a{color:#4f86ff;text-decoration:none}

    .box{
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:16px;
      padding:20px;
      margin:20px auto;
      max-width:900px;
    }

    select,button{
      padding:10px 14px;
      border-radius:10px;
      border:none;
      margin-right:10px;
      font-size:14px;
    }

    button{
      background:#4f86ff;
      color:white;
      cursor:pointer;
      font-weight:bold;
    }

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:16px;
      font-size:14px;
    }
    th,td{
      padding:10px;
      text-align:center;
      border-bottom:1px solid rgba(255,255,255,0.15);
    }

    canvas{
      max-height:260px;
      width:100% !important;
    }

    .insight{
      background:rgba(79,134,255,0.15);
      padding:14px;
      border-radius:12px;
      margin:20px auto;
      max-width:900px;
      font-size:14px;
    }
  </style>
</head>

<body>

<!-- Top Bar -->
<div class="top">
  <b>Player Comparison</b>
  <a href="/dashboard/">‚Üê Back to Dashboard</a>
</div>

<!-- Player Selection -->
<div class="box">
  <form method="get">
    <select name="p1">
      <option value="">Select Player A</option>
      {% for p in players %}
        <option value="{{ p.id }}" {% if p1_id == p.id|stringformat:"s" %}selected{% endif %}>
          {{ p.player_name }}
        </option>
      {% endfor %}
    </select>

    <select name="p2">
      <option value="">Select Player B</option>
      {% for p in players %}
        <option value="{{ p.id }}" {% if p2_id == p.id|stringformat:"s" %}selected{% endif %}>
          {{ p.player_name }}
        </option>
      {% endfor %}
    </select>

    <button type="submit">Compare</button>
  </form>
</div>

{% if p1_id and p2_id %}

<!-- Chart -->
<div class="box">
  <h3>Performance Comparison</h3>
  <canvas id="cmpChart"></canvas>

  <!-- SAFE DATA PASSING -->
  {{ p1|json_script:"p1-data" }}
  {{ p2|json_script:"p2-data" }}

  <script>
    const p1 = JSON.parse(document.getElementById("p1-data").textContent);
    const p2 = JSON.parse(document.getElementById("p2-data").textContent);

    new Chart(document.getElementById("cmpChart"), {
      type: "radar",
      data: {
        labels: ["Goals","Assists","Tackles","Shots on Target"],
        datasets: [
          {
            label: "Player A",
            data: [
              p1.goals,
              p1.assists,
              p1.tackles,
              p1.shots_on_target
            ],
            borderColor:"#4f86ff",
            backgroundColor:"rgba(79,134,255,0.15)"
          },
          {
            label: "Player B",
            data: [
              p2.goals,
              p2.assists,
              p2.tackles,
              p2.shots_on_target
            ],
            borderColor:"#ff6b6b",
            backgroundColor:"rgba(255,107,107,0.15)"
          }
        ]
      },
      options:{
        responsive:true,
        maintainAspectRatio:false,
        plugins:{
          legend:{labels:{color:"white"}}
        },
        scales:{
          r:{
            angleLines:{color:"rgba(255,255,255,0.2)"},
            grid:{color:"rgba(255,255,255,0.2)"},
            pointLabels:{color:"white"},
            ticks:{display:false}
          }
        }
      }
    });
  </script>
</div>

<!-- Comparison Table -->
<div class="box">
  <h3>Detailed Statistics</h3>
  <table>
    <tr><th>Metric</th><th>Player A</th><th>Player B</th></tr>
    <tr><td>Goals</td><td>{{ p1.goals }}</td><td>{{ p2.goals }}</td></tr>
    <tr><td>Assists</td><td>{{ p1.assists }}</td><td>{{ p2.assists }}</td></tr>
    <tr><td>Tackles</td><td>{{ p1.tackles }}</td><td>{{ p2.tackles }}</td></tr>
    <tr><td>Shots on Target</td><td>{{ p1.shots_on_target }}</td><td>{{ p2.shots_on_target }}</td></tr>
  </table>
</div>

{% if insight %}
<div class="insight">
  <b>Insight:</b> {{ insight }}
</div>
{% endif %}

{% endif %}

</body>
</html>
