<!doctype html>
<html>
<head>
  <title>Playing XI Player Comparison</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body{
      margin:0;
      font-family: Arial, sans-serif;
      background: radial-gradient(circle at top, #0b1220, #050816);
      color:white;
    }

    .top{
      padding:20px 28px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:1px solid rgba(255,255,255,0.08);
    }

    .top a{
      color:#4f86ff;
      text-decoration:none;
      font-size:14px;
    }

    .container{
      padding:30px 28px;
      max-width:1000px;
      margin:auto;
    }

    h2{
      margin-bottom:10px;
    }

    select{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:none;
      font-size:14px;
      margin-bottom:16px;
    }

    .players{
      height:220px;
    }

    button{
      padding:14px 22px;
      background:#4f86ff;
      color:white;
      border:none;
      border-radius:14px;
      font-size:15px;
      cursor:pointer;
      font-weight:bold;
    }

    .chart-box{
      margin-top:40px;
      background:rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:18px;
      padding:26px;
    }

    .note{
      margin-top:20px;
      padding:14px;
      background:rgba(79,134,255,0.15);
      border-radius:12px;
      font-size:14px;
    }
  </style>
</head>

<body>

<div class="top">
  <b>üë• Playing XI Player Comparison</b>
  <a href="/dashboard/">‚Üê Back to Dashboard</a>
</div>

<div class="container">

  <p>
    Select how many players you want to compare (minimum 2, maximum 11).
    This compares <b>individual player contributions</b>, not team totals.
  </p>

  <!-- FORM -->
  <form method="get">

    <label><b>Select number of players:</b></label>
    <select name="count" required>
      <option value="">-- Select --</option>
      {% for i in "23456789101"|make_list %}
        <option value="{{ i }}" {% if max_count == i|add:"0" %}selected{% endif %}>{{ i }}</option>
      {% endfor %}
    </select>

    <label><b>Select players:</b></label>
    <select name="players" multiple class="players">
      {% for p in players %}
        <option value="{{ p.id }}">{{ p.player_name }} ({{ p.position }})</option>
      {% endfor %}
    </select>

    <button type="submit">Compare Players</button>
  </form>

  <!-- CHARTS -->
  {% if labels %}
  <div class="chart-box">
    <h3>üìä Player Performance Comparison</h3>

    <canvas id="goalsChart"></canvas>
    <br><br>
    <canvas id="assistsChart"></canvas>
    <br><br>
    <canvas id="tacklesChart"></canvas>
    <br><br>
    <canvas id="shotsChart"></canvas>

    <div class="note">
      üìà <b>Analytics Insight:</b>
      This visualization compares selected players equally across multiple performance metrics.
    </div>
  </div>
  {% endif %}

</div>

<!-- DATA FROM DJANGO -->
{{ labels|json_script:"labels" }}
{{ goals|json_script:"goals" }}
{{ assists|json_script:"assists" }}
{{ tackles|json_script:"tackles" }}
{{ shots|json_script:"shots" }}

<!-- CHART SCRIPT -->
<script>
const labels = JSON.parse(document.getElementById("labels")?.textContent || "[]");
const goals = JSON.parse(document.getElementById("goals")?.textContent || "[]");
const assists = JSON.parse(document.getElementById("assists")?.textContent || "[]");
const tackles = JSON.parse(document.getElementById("tackles")?.textContent || "[]");
const shots = JSON.parse(document.getElementById("shots")?.textContent || "[]");

function drawChart(id, label, data){
  new Chart(document.getElementById(id), {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: label,
        data: data,
        backgroundColor: '#4f86ff'
      }]
    },
    options:{
      responsive:true,
      scales:{ y:{ beginAtZero:true } }
    }
  });
}

if(labels.length){
  drawChart("goalsChart", "Goals", goals);
  drawChart("assistsChart", "Assists", assists);
  drawChart("tacklesChart", "Tackles", tackles);
  drawChart("shotsChart", "Shots on Target", shots);
}
</script>

</body>
</html>
